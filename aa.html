<html><head><title>Arabic Almanac</title>
<link rel="shortcut icon" href="aa.ico" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style>
body { width: 100%; background-color: #DDD; }
#chapters_index, #chapter_contents, table.navtable { width: 100%; }
#chapter_contents { font-family: Simplified Arabic; }
body, div { margin: 0; padding: 0; }
/*
table.navtable td { min-width: 10%; }
a { color: black; text-decoration: none; }
*/
.navtable a, #settings_container a { color: black; text-decoration: none; }
.indexbutton { 
	margin: 0; padding: 0;
	padding-right: 15px;
	padding-left: 15px;
	font-size: xx-large;
	width: 100%; background-color: silver;
	}
.book_toggle { 
	width: 100%; background-color: silver;
	font-size: x-large; 
	/*
	text-align: right; 
	*/
	padding-top: 1px; padding-bottom: 1px; 
	}
.button { 
	width: 100%; background-color: silver;
	font-size: large; text-align: center; 
	padding-top: 7px; padding-bottom: 7px; 
	}
.small_button { 
	width: 100%; background-color: silver;
	text-align: center; 
	}

hr { margin: 5px; }

.column_indicator { width: 100% }
.column_indicator td { margin: 2; padding: 2; background-color: gray; }
.act  { background-color: blue; }
.index_table td { 
	font-size: xx-large; 
	text-align: center; 
	}

/*
.green-gradient {
	margin: 2px;
	background-image: -webkit-linear-gradient(top,rgb(0,90,0),rgb(0,255,0));
	background-image:    -moz-linear-gradient(top,rgb(0,90,0),rgb(0,255,0));
	background-image:     -ms-linear-gradient(top,rgb(0,90,0),rgb(0,255,0));
	background-image:      -o-linear-gradient(top,rgb(0,90,0),rgb(0,255,0));
}
*/

.rainbow {
	/* padding: 2px;*/
	margin: 2px;
	/* Make a rainbow gradient */
	/*
	background-image: -o-linear-gradient(top,rgb(255,0,0),rgb(0,0,255));
	background-image: -o-linear-gradient(top,rgb(255,0,0),rgb(0,255,0) 50%,rgb(0,0,255));
	*/
	background-image: -o-linear-gradient(top,rgb(255,0,0),rgb(0,255,0) 50%,rgb(0,0,255));
}

/*
<meta name='viewport' content='width=device-width, initial-scale=1.0'/>  
*/

.column {
	width: 98%;
	overflow: hidden;
}

#settings_container,#hw3_toggle,#ll_toggle,#ls_toggle,#ha_toggle,#sg_toggle,#hw4_toggle,#br_toggle,#pr_toggle { display: none; }
#settings_container { border: solid white 5px; }
#settings_2 td { border-bottom: solid white 1px; }

#hw4_col1,#hw4_col2,#pr_col1,#pr_col2,#hw3_col1,#hw3_col2,#ha_col1,#ha_col2,#sg_col1,#sg_col2 {
	position: relative;
	width: 200%;
}
#ha_col2 {
	left: 0%;
}

#hw4_col2,#pr_col2,#hw3_col2,#ha_col1,#sg_col2 {
	right: 100%;
}

#ll_col1,#ll_col2,#ll_col3,#ls_col1,#ls_col2,#ls_col3 {
	position: relative;
	width: 285%;
}
#ll_col2,#ls_col2 {
/*
	right: 100%;
	right: 200%;
	left: -185%;
*/
	left: -95%;
}
#ll_col3,#ls_col3 {
	left: -185%;
	right: 100%;
}
#penrice         .navtable td div, #pr_toggle,  .PR_color , #pr_status_line  { background-color: orchid; }
#brill           .navtable td div, #br_toggle,  .BR_color , #br_status_line  { background-color: magenta; }
#steingass       .navtable td div, #sg_toggle,  .SG_color , #sg_status_line  { background-color: turquoise; }
#hanswehr3       .navtable td div, #hw3_toggle, .HW3_color, #hw3_status_line { background-color: coral; }
#hanswehr4       .navtable td div, #hw4_toggle, .HW4_color, #hw4_status_line { background-color: salmon; }
#laneslexicon    .navtable td div, #ll_toggle,  .LL_color , #ll_status_line  { background-color: lawngreen; }
#laneslexiconsup .navtable td div, #ls_toggle,  .LS_color , #ls_status_line  { background-color: palegreen; }
#hava            .navtable td div, #ha_toggle,  .HA_color , #ha_status_line  { background-color: gold; }
#pr_wideviewimg  { border: 3px solid orchid; }
#br_wideviewimg  { border: 3px solid magenta; }
#sg_wideviewimg  { border: 3px solid turquoise; }
#hw3_wideviewimg { border: 3px solid coral; }
#hw4_wideviewimg { border: 3px solid salmon; }
#ll_wideviewimg  { border: 3px solid lawngreen; }
#ls_wideviewimg  { border: 3px solid palegreen; }
#ha_wideviewimg  { border: 3px solid gold; }
/*
#penrice         .navtable td div, #pr_toggle,  .PR_color , #pr_status_line  { background-color: #EAF; }
#brill           .navtable td div, #br_toggle,  .BR_color , #br_status_line  { background-color: #CAC; }
#steingass       .navtable td div, #sg_toggle,  .SG_color , #sg_status_line  { background-color: #ACC; }
#hanswehr3       .navtable td div, #hw3_toggle, .HW3_color, #hw3_status_line { background-color: #A88; }
#hanswehr4       .navtable td div, #hw4_toggle, .HW4_color, #hw4_status_line { background-color: #CAA; }
#laneslexicon    .navtable td div, #ll_toggle,  .LL_color , #ll_status_line  { background-color: #ACA; }
#laneslexiconsup .navtable td div, #ls_toggle,  .LS_color , #ls_status_line  { background-color: #AAC; }
#hava            .navtable td div, #ha_toggle,  .HA_color , #ha_status_line  { background-color: #CCA; }
#pr_wideviewimg  { border: 3px solid #C8A; }
#br_wideviewimg  { border: 3px solid #A0C; }
#sg_wideviewimg  { border: 3px solid #ACC; }
#hw3_wideviewimg { border: 3px solid #CAA; }
#hw4_wideviewimg { border: 3px solid #CA0; }
#ll_wideviewimg  { border: 3px solid #ACA; }
#ls_wideviewimg  { border: 3px solid #AAC; }
#ha_wideviewimg  { border: 3px solid #CCA; }
*/

/*
*/

</style>
<!-- Google Analytics stuff: -->
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-34010688-1']);
_gaq.push(['_setDomainName', 'ejtaal.net']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  if ('file:' != document.location.protocol)
  	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
<meta name='viewport' content='width=device-width'/>  
</head>
<body>

<table class='navtable'>
<tr>
	<td><a href='javascript:toggle_settings()' title='Settings menu'><div class='button' ><span style='border-top: 3px solid black; border-bottom: 3px solid black;'><b>&mdash;&mdash;&mdash;</b></span></div></a></td>
	<td><a href='readme.html' title='More information about this website'><div class='button'>About</div></a></td>
	<td><a href='javascript:toggle_view()' title='Toggle between mobile (column view) and desktop (full page) view'><div class='button'>Mobile</div></a></td>
	<td><a href='javascript:toggle_fitwidth()' title='Toggle to have pages fit to your browser window'><div class='button'>|&larr;&rarr;|</div></a></td>
	<td><a href='javascript:searchandgo()' title='Lookup root letters'><div class='button'>Search</div></a></td>
</tr>
</table>

<!--
 &plusmn;
<hr>
<a href="http://ejtaal.net/donate/" >
<div style='margin: 1%; width: 100%; height: 5%; color: white; background-color: navy; border: 1 solid white;'>
<center>
::: Please donate if you like this page, click here :::
</center>
</div>
-->
<center>
<small>
<span id='statusbar'></span>
<span id='searchbar'></span>
<span id='version'></span> | Viewing mode: <em><span id='currentmode'></span></em>.
</small>
<div id=debug>
</div>
</center>

<center>

<div id='settings_container'>
	<b>Settings</b><br>
	
	Choose the order in which you want the available books displayed:<br>
	<div id='settings_2'>
	</div>
	You can also choose from these presets:
	<table><tr>
	<td>
	<a href="javascript:set_order_preset('quran')"><div class='button'>Quran</div></a>
	<td>
	<a href="javascript:set_order_preset('modern')"><div class='button'>Modern</div></a>
	<td>
	<a href="javascript:set_order_preset('default')"><div class='button'>Default</div></a>
	</tr></table>
	<br>

<!--
	<div id='settings'>
		<select id=setbook1></select><br>
		<select id=setbook2></select><br>
		<select id=setbook3></select><br>
		<select id=setbook4></select><br>
		<select id=setbook5></select><br>
	</div>
-->
	<a href='javascript:save_settings()'><div class='button'>Save</div></a>
	<hr>
</div>

<div id='all_books'>

<!--
-->
<div id='HW4'>
<div class='book_toggle' id='hw4_toggle' onclick="javascript:hide_book('HW4', false);"> Show Hans Wehr 4 [_] </div>
<div id='hanswehr4'>
<table class='navtable'>
<tr>
	<td> <a href='javascript:shift_page("HW4", -1)' id='hw4_a_prev2'><div class='button'>&larr;</div></a> </td>
	<td> <a href='javascript:hw4_showindex()'><div class='button'>HW4</div></a> </td>
	<td> <a href="javascript:hide_book( 'HW4', true);"><div class='button'>hide</div></a> </td>
	<td> <a href='javascript:shift_page("HW4", 1)' id='hw4_a_next2'><div class='button'>&rarr;</div></a> </td>
</tr>
</table>
<span class='status_line' id='hw4_status_line'></span>
<div class='HW4_color narrowview' id='hw4_narrowview'>
	<div class='column' id='div_hw4_col1'>
		<img id='hw4_col1' onClick='javascript:searchandgo()'>
	</div>
	<hr>
	<div class='column' id='div_hw4_col1'>
		<img id='hw4_col2' onClick='javascript:searchandgo()'>
	</div>
			
</div>
		
<div id='hw4_wideview'>
	<img class='wideview' id='hw4_wideviewimg' onClick='javascript:searchandgo()'>
</div>
<table class='navtable'>
<tr>
	<td> <a href='javascript:shift_page("HW4", -1)'><div class='button'>&larr;</div></a> </td>
	<td> <a href='javascript:shift_page("HW4", 1)' ><div class='button'>&rarr;</div></a> </td>
</tr>
</table>
</div>
<hr>
</div>
<!--
-->
<div id='HW3'>
<div class='book_toggle' id='hw3_toggle' onclick="javascript:hide_book('HW3', false);"> Show Hans Wehr 3 [_] </div>
<div id='hanswehr3'>
<table class='navtable'>
<tr>
	<td> <a href='javascript:shift_page("HW3", -1)' id='hw3_a_prev2'><div class='button'>&larr;</div></a> </td>
	<td> <a href='javascript:hw3_showindex()'><div class='button'>HW3</div></a> </td>
	<td> <a href="javascript:hide_book( 'HW3', true);"><div class='button'>hide</div></a> </td>
	<td> <a href='javascript:shift_page("HW3", 1)' id='hw3_a_next2'><div class='button'>&rarr;</div></a> </td>
</tr>
</table>
<span class='status_line' id='hw3_status_line'></span>
<div class='HW3_color narrowview' id='hw3_narrowview'>
	<div class='column' id='div_hw3_col1'>
		<img id='hw3_col1' onClick='javascript:searchandgo()'>
	</div>
	<hr>
	<div class='column' id='div_hw3_col1'>
		<img id='hw3_col2' onClick='javascript:searchandgo()'>
	</div>
			
</div>
		
<div id='hw3_wideview'>
	<img class='wideview' id='hw3_wideviewimg' onClick='javascript:searchandgo()'>
</div>
<table class='navtable'>
<tr>
	<td> <a href='javascript:shift_page("HW3", -1)'><div class='button'>&larr;</div></a> </td>
	<td> <a href='javascript:shift_page("HW3", 1)' ><div class='button'>&rarr;</div></a> </td>
</tr>
</table>
</div>
<hr>
</div>
<!--
-->
<div id='LL'>
<div class='book_toggle' id='ll_toggle' onclick="javascript:hide_book('LL', false);"> Show Lane's Lexicon [_] </div>
<div id='laneslexicon'>
<table class='navtable'>
<tr>
	<td> <a href='javascript:shift_page("LL", -1)' id='ll_a_prev2'><div class='button'>&larr;</div></a> </td>
	<td> <a href='javascript:ll_showindex()'><div class='button'>LL</div></a> </td>
	<td> <a href="javascript:hide_book('LL', true);"><div class='button'>hide</div></a> </td>
	<td> <a href='javascript:shift_page("LL", 1)' id='ll_a_next2'><div class='button'>&rarr;</div></a> </td>
</tr>
</table>
<span class='status_line' id='ll_status_line'></span>

<div class='LL_color narrowview' id='ll_narrowview'>
	<div class='column'>
		<img id='ll_col1' onClick='javascript:searchandgo()'>
	</div>
	<hr>
	<div class='column'>
		<img id='ll_col2' onClick='javascript:searchandgo()'>
	</div>
	<hr>
	<div class='column'>
		<img id='ll_col3' onClick='javascript:searchandgo()'>
	</div>
			
</div>
		
<div id='ll_wideview'>
	<img class='wideview' id='ll_wideviewimg' onClick='javascript:searchandgo()'>
</div>
<table class='navtable'>
<tr>
	<td> <a href='javascript:shift_page("LL", -1)'><div class='button'>&larr;</div></a> </td>
	<td> <a href='javascript:shift_page("LL", 1)' ><div class='button'>&rarr;</div></a> </td>
</tr>
</table>
</div>
<hr>
</div>


<!--
-->
<div id='LS'>
<div class='book_toggle' id='ls_toggle' onclick="javascript:hide_book('LS', false);">
<span id='ls_search_status'></span>
Show Supplement [_]
</div>
<div id='laneslexiconsup'>
<table class='navtable'>
<tr>
	<td> <a href='javascript:shift_page("LS", -1)' id='ls_a_prev2'><div class='button'>&larr;</div></a> </td>
	<td> <a href='javascript:ls_showindex()'><div class='button'>LS</div></a> </td>
	<td> <a href="javascript:hide_book('LS', true);"><div class='button'>hide</div></a> </td>
	<td> <a href='javascript:shift_page("LS", 1)' id='ls_a_next2'><div class='button'>&rarr;</div></a> </td>
</tr>
</table>
<span class='status_line' id='ls_status_line'></span>

<div class='LS_color narrowview' id='ls_narrowview'>
	<div class='column'>
		<img id='ls_col1' onClick='javascript:searchandgo()'>
	</div>
	<hr>
	<div class='column'>
		<img id='ls_col2' onClick='javascript:searchandgo()'>
	</div>
	<hr>
	<div class='column'>
		<img id='ls_col3' onClick='javascript:searchandgo()'>
	</div>
			
</div>
		
<div id='ls_wideview'>
	<img class='wideview' id='ls_wideviewimg' onClick='javascript:searchandgo()'>
</div>
<table class='navtable'>
<tr>
	<td> <a href='javascript:shift_page("LS", -1)'><div class='button'>&larr;</div></a> </td>
	<td> <a href='javascript:shift_page("LS", 1)' ><div class='button'>&rarr;</div></a> </td>
</tr>
</table>
</div>
<hr>
</div>

<!--
-->
<div id='HA'>
	<div class='book_toggle' id='ha_toggle' onclick="javascript:hide_book('HA', false);"> Show Hava [_] </div>
	<div id='hava'>
		<table class='navtable'>
		<tr>
			<td> <a href='javascript:shift_page("HA", -1)' id='ha_a_prev2'><div class='button'>&larr;</div></a> </td>
			<td> <a href='javascript:ha_showindex()'><div class='button'>HA</div></a> </td>
			<td> <a href="javascript:hide_book( 'HA', true);"><div class='button'>hide</div></a> </td>
			<td> <a href='javascript:shift_page("HA", 1)' id='ha_a_next2'><div class='button'>&rarr;</div></a> </td>
		</tr>
		</table>
		<span class='status_line' id='ha_status_line'></span>
		<div class='HA_color narrowview' id='ha_narrowview'>
			<div class='column' id='div_ha_col1'>
				<img id='ha_col1' onClick='javascript:searchandgo()'>
			</div>
			<hr>
			<div class='column' id='div_ha_col1'>
				<img id='ha_col2' onClick='javascript:searchandgo()'>
			</div>
		</div>
				
		<div id='ha_wideview'>
			<img class='wideview' id='ha_wideviewimg' onClick='javascript:searchandgo()'>
		</div>
		<table class='navtable'>
		<tr>
			<td> <a href='javascript:shift_page("HA", -1)'><div class='button'>&larr;</div></a> </td>
			<td> <a href='javascript:shift_page("HA", 1)' ><div class='button'>&rarr;</div></a> </td>
		</tr>
		</table>
	</div>
	<hr>
</div>

<div id='SG'>
	<div class='book_toggle' id='sg_toggle' onclick="javascript:hide_book('SG', false);"> Show Steingass [_] </div>
	<div id='steingass'>
		<table class='navtable'>
		<tr>
			<td> <a href='javascript:shift_page("SG", -1)' id='sg_a_prev2'><div class='button'>&larr;</div></a> </td>
			<td> <a href='javascript:sg_showindex()'><div class='button'>SG</div></a> </td>
			<td> <a href="javascript:hide_book( 'SG', true);"><div class='button'>hide</div></a> </td>
			<td> <a href='javascript:shift_page("SG", 1)' id='sg_a_next2'><div class='button'>&rarr;</div></a> </td>
		</tr>
		</table>
		<span class='status_line' id='sg_status_line'></span>
		<div class='SG_color narrowview' id='sg_narrowview'>
			<div class='column' id='div_sg_col1'>
				<img id='sg_col1' onClick='javascript:searchandgo()'>
			</div>
			<hr>
			<div class='column' id='div_sg_col1'>
				<img id='sg_col2' onClick='javascript:searchandgo()'>
			</div>
		</div>
				
		<div id='sg_wideview'>
			<img class='wideview' id='sg_wideviewimg' onClick='javascript:searchandgo()'>
		</div>
		<table class='navtable'>
		<tr>
			<td> <a href='javascript:shift_page("SG", -1)'><div class='button'>&larr;</div></a> </td>
			<td> <a href='javascript:shift_page("SG", 1)' ><div class='button'>&rarr;</div></a> </td>
		</tr>
		</table>
	</div>
	<hr>
</div>


<div id='BR'>
	<div class='book_toggle' id='br_toggle' onclick="javascript:hide_book('BR', false);"> Show Brill [_] </div>
	<div id='brill'>
		<table class='navtable'>
		<tr>
			<td> <a href='javascript:shift_page("BR", -1)' id='br_a_prev2'><div class='button'>&larr;</div></a> </td>
			<td> <a href='javascript:br_showindex()'><div class='button'>BR</div></a> </td>
			<td> <a href="javascript:hide_book( 'BR', true);"><div class='button'>hide</div></a> </td>
			<td> <a href='javascript:shift_page("BR", 1)' id='br_a_next2'><div class='button'>&rarr;</div></a> </td>
		</tr>
		</table>
		<span class='status_line' id='br_status_line'></span>
		<!-- Brill doesn't have columns, hence no narrowview -->
		<!--
		<div class='teal-gradient' id='br_narrowview'>
			<div class='column' id='div_br_col1'>
				<img id='br_col1' onClick='javascript:searchandgo()'>
			</div>
			<hr>
			<div class='column' id='div_br_col1'>
				<img id='br_col2' onClick='javascript:searchandgo()'>
			</div>
		</div>
			<img class='wideview' id='br_wideviewimg' onClick='javascript:searchandgo()'>
		-->		
		<div id='br_wideview'>
		<!-- Brill doesn't have columns, hence no wideview classed img either -->
			<img id='br_wideviewimg' onClick='javascript:searchandgo()'>
		</div>
		<table class='navtable'>
		<tr>
			<td> <a href='javascript:shift_page("BR", -1)'><div class='button'>&larr;</div></a> </td>
			<td> <a href='javascript:shift_page("BR", 1)' ><div class='button'>&rarr;</div></a> </td>
		</tr>
		</table>
	</div>
	<hr>
</div>


<div id='PR'>
	<div class='book_toggle' id='pr_toggle' onclick="javascript:hide_book('PR', false);"> Show Penrice [_] </div>
	<div id='penrice'>
		<table class='navtable'>
		<tr>
			<td> <a href='javascript:shift_page("PR", -1)' id='pr_a_prev2'><div class='button'>&larr;</div></a> </td>
			<td> <a href='javascript:pr_showindex()'><div class='button'>PR</div></a> </td>
			<td> <a href="javascript:hide_book( 'PR', true);"><div class='button'>hide</div></a> </td>
			<td> <a href='javascript:shift_page("PR", 1)' id='pr_a_next2'><div class='button'>&rarr;</div></a> </td>
		</tr>
		</table>
		<span class='status_line' id='pr_status_line'></span>
		<div class='PR_color narrowview' id='pr_narrowview'>
			<div class='column' id='div_pr_col1'>
				<img id='pr_col1' onClick='javascript:searchandgo()'>
			</div>
			<hr>
			<div class='column' id='div_pr_col1'>
				<img id='pr_col2' onClick='javascript:searchandgo()'>
			</div>
		</div>
				
		<div id='pr_wideview'>
			<img class='wideview' id='pr_wideviewimg' onClick='javascript:searchandgo()'>
		</div>
		<table class='navtable'>
		<tr>
			<td> <a href='javascript:shift_page("PR", -1)'><div class='button'>&larr;</div></a> </td>
			<td> <a href='javascript:shift_page("PR", 1)' ><div class='button'>&rarr;</div></a> </td>
		</tr>
		</table>
	</div>
	<hr>
</div>

<!--
-->

<!-- end of div all_books -->
</div>

<!--
-->
<hr>
<table class='navtable'>
<tr>
	<td><a href='javascript:toggle_settings()' title='Settings menu'><div class='button' ><span style='border-top: 3px solid black; border-bottom: 3px solid black;'><b>&mdash;</b></span></div></a></td>
	<td><a href='readme.html' title='More information about this website'><div class='button'>About</div></a></td>
	<td><a href='javascript:toggle_view()' title='Toggle between mobile (column view) and desktop (full page) view'><div class='button'>Mobile</div></a></td>
	<td><a href='javascript:toggle_fitwidth()' title='Toggle to have pages fit to your browser window'><div class='button'>|&larr;&rarr;|</div></a></td>
	<td><a href='javascript:searchandgo()' title='Lookup root letters'><div class='button'>Search</div></a></td>
</tr>
</table>

<!--
http://www.openjs.com/scripts/events/keyboard_shortcuts/
-->
<script type="text/javascript" src="jslib/jquery.js"></script>
<script type="text/javascript" src="jslib/jquery.ba-hashchange.min.js"></script>
<script type="text/javascript" src="jslib/shortcut.js"></script>
<!-- Data for Hans Wehr -->
<script type="text/javascript" src="aa-hw3-index.js?001"></script>
<script type="text/javascript" src="aa-hw4-index.js?003"></script>
<!-- Data for Lane's Lexicon &  Supplement -->
<script type="text/javascript" src="aa-ll-index.js?000"></script>
<!-- Data for Hava -->
<script type="text/javascript" src="aa-ha-index.js?001"></script>
<script type="text/javascript" src="aa-sg-index.js?001"></script>
<script type="text/javascript" src="aa-br-index.js?004"></script>
<script type="text/javascript" src="aa-pr-index.js?003"></script>
<!--
<script type="text/javascript" src="aa-ll-data.js"></script>
<script type="text/javascript" src="aa-ls-data.js"></script>
-->
<script>

// Some global vars that we need:
var version = "3.0";
var title_text = "Arabic Almanac" + " v" + version;
var toggle = 1;
var hw4_offset = 14;
var hw3_offset = 19;
var ha_offset = 21;
var sg_offset = 20;
var br_offset = 26;
var pr_offset = 9;
//var total_pages = 1129;
var initial_book_order = "HW4,LL,LS,SG,BR,PR,HA,HW3";
var aa_book_order = initial_book_order;
var starting_hash = "#HW4=14,LL=1_38,LS=3,HA=21,SG=20,BR=26,PR=9";
var cur_hw3_page = 19, req_hw3_page = 19;
var cur_hw4_page = 14, req_hw4_page = 14;
var cur_br_page = 26, req_br_page = 26;
var cur_pr_page = 9, req_pr_page = 9;
var cur_ll_page = 38, req_ll_page = 38;
var cur_ll_vol = 1, req_ll_vol = 1;
var cur_ls_page = 3, req_ls_page = 3;
var cur_ha_page = 20, req_ha_page = 20;
var cur_sg_page = 20, req_sg_page = 20;
var hw4_hide = false, br_hide = false, pr_hide = false, hw3_hide = false, 
	ll_hide = false, ls_hide = false, ha_hide = false, sg_hide = false;
var toggle_view_auto = 1;
var toggle_view_mode;
var fitwidth = false;
var last_input = "";
var searched_word = "";

// Setup shortcuts:
shortcut.add("F",function() { searchandgo(); });
shortcut.add("V",function() { toggle_view(); });

shortcut.add("Z",function() { visible_book_shift( -1); });
shortcut.add("D",function() { visible_book_shift( -1); });
shortcut.add("Left",function() { visible_book_shift( -1); });
shortcut.add("X",function() { visible_book_shift( 1); });
shortcut.add("G",function() { visible_book_shift( 1); });
shortcut.add("Right",function() { visible_book_shift( 1); });
shortcut.add("P",function() { testing123(); });
shortcut.add("W",function() { toggle_fitwidth(); });


function move_up( id) {
	var content = document.getElementById(id);
	var parent = content.parentNode;
	parent.insertBefore(content, parent.firstChild);
	
	var aa_book_order = "";
	$('#all_books').children().each(function(){
		var kid = $(this);
	 	//debug( kid.attr('id'));
		aa_book_order += kid.attr('id') + ",";
	 	//i++;
	});
	setCookie('aa_book_order', aa_book_order, 365);
}

function hide_book( book, should_hide) {
	if ( book == "HW4") { 
		hw4_hide = should_hide;
		if ( should_hide) hide_show( 'hanswehr4', 'hw4_toggle');
		else              hide_show( 'hw4_toggle', 'hanswehr4');
	}
	if ( book == "HW3") { 
		hw3_hide = should_hide;
		if ( should_hide) hide_show( 'hanswehr3', 'hw3_toggle');
		else              hide_show( 'hw3_toggle', 'hanswehr3');
	}
	if ( book == "LL") { 
		ll_hide = should_hide;
		if ( should_hide) hide_show( 'laneslexicon', 'll_toggle');
		else              hide_show( 'll_toggle', 'laneslexicon');
	}
	if ( book == "LS") { 
		ls_hide = should_hide;
		if ( should_hide) hide_show( 'laneslexiconsup', 'ls_toggle');
		else              hide_show( 'ls_toggle', 'laneslexiconsup');
	}
	if ( book == "HA") { 
		ha_hide = should_hide;
		if ( should_hide) hide_show( 'hava', 'ha_toggle');
		else              hide_show( 'ha_toggle', 'hava');
	}
	if ( book == "SG") { 
		sg_hide = should_hide;
		if ( should_hide) hide_show( 'steingass', 'sg_toggle');
		else              hide_show( 'sg_toggle', 'steingass');
	}
	if ( book == "BR") { 
		br_hide = should_hide;
		if ( should_hide) hide_show( 'brill', 'br_toggle');
		else              hide_show( 'br_toggle', 'brill');
	}
	if ( book == "PR") { 
		pr_hide = should_hide;
		if ( should_hide) hide_show( 'penrice', 'pr_toggle');
		else              hide_show( 'pr_toggle', 'penrice');
	}
	// Save this state in the hash
	build_hash();

}

function hideme_show( hideobj, showobj) {
  hideobj.style.display = "none";
  //document.getElementById(showobj).style.display = "block";
	$("#"+showobj).show('fast');
}

function hide_id( id, scrollto) {
  //document.getElementById( id).style.display = "none";
	//debug( 'hiding ' + id);
	$("#"+id).hide('fast');
	if (scrollto) {
		//debug( 'scrolling to: ' +id);
		$(window).scrollTop( $("#"+id).offset().top);
	}
}

function hide_show( hideid, showid, scrollto) {
  //document.getElementById(hideid).style.display = "none";
  //document.getElementById(showid).style.display = "block";
	$("#"+hideid).hide('fast');
	$("#"+showid).show('fast');
	if (scrollto) {
		//debug( 'scrolling to: ' +showid);
		$(window).scrollTop( $("#"+showid).offset().top);
	}
}

function set_hash( s) {
	hide_id('about');
	window.location.hash = s;
	setCookie( "aa_last_hash", window.location.hash, 365);
}
function build_hash() {
	var new_hash = "#HW4=" + req_hw4_page + ",HW3=" + req_hw3_page
		+ ",LL=" + req_ll_vol + "_" + req_ll_page
		+ ",LS=" + req_ls_page + ",HA=" + req_ha_page
		+ ",SG=" + req_sg_page + ",BR=" + req_br_page
		+ ",PR=" + req_pr_page;
	if ( hw4_hide) new_hash += ",HW4_HIDE";
	if ( hw3_hide) new_hash += ",HW3_HIDE";
	if ( ll_hide) new_hash += ",LL_HIDE";
	if ( ls_hide) new_hash += ",LS_HIDE";
	if ( ha_hide) new_hash += ",HA_HIDE";
	if ( sg_hide) new_hash += ",SG_HIDE";
	if ( br_hide) new_hash += ",BR_HIDE";
	if ( pr_hide) new_hash += ",PR_HIDE";
	window.location.hash = new_hash;
	setCookie( "aa_last_hash", window.location.hash, 365);
}

function set_title() {
	var title = "";
	var i = 1;
	//TODO: in order of books displayed:
	if ( searched_word == "" ) {
		$('#all_books').children().each(function(){
			var id = $(this).attr('id');
	 		//debug( id);
			var add_text = "";
			if ( id == "HA" && ! ha_hide) add_text = "HA: " + ha_p[cur_ha_page];
			if ( id == "HW3" && ! hw3_hide) add_text = "HW3: " + hw3[cur_hw3_page];
			if ( id == "HW4" && ! hw4_hide) add_text = "HW4: " + hw4[cur_hw4_page];
			if ( id == "LL" && ! ll_hide) add_text = "LL: " + ll_p[get_ll_page( cur_ll_vol, cur_ll_page)];
			if ( id == "LS" && ! ls_hide) add_text = "LS: " + ls_p[cur_ls_page];
			if ( id == "SG" && ! sg_hide) add_text = "SG: " + sg[cur_sg_page];
			if ( id == "BR" && ! br_hide) add_text = "BR: " + sg[cur_br_page];
			if ( id == "PR" && ! pr_hide) add_text = "PR: " + sg[cur_pr_page];
			if ( add_text != "") 
				if ( title != "") title += " / " + add_text;
				else title = add_text;
		});
	}
	else title = "Search: " + searched_word;
	if (title != "") title += " - ";
	title += title_text;
	//alert( title);
	document.title = title;
}

function parse_hash() {
	var hashstring = window.location.hash.replace(/^#/,'');
	var i, variables = hashstring.split(','); 
	if (variables.length > 0) { 
	    // Variables present in hash 
	    for (i = 0; i < variables.length; i++) { 
	       keyValuePair = variables[i].split('='); 
					//alert( "Var found: " + keyValuePair[0] + ' = ' + keyValuePair[1] );
					var book = keyValuePair[0];
					var page = keyValuePair[1];
					//debug( "Var found: " + keyValuePair[0] + ' = ' + keyValuePair[1] );
					if ( book == "Q" || book == "q" ) { do_search(page); }
					if ( book == "SEARCH" || book == "search" ) { searchandgo(); }
					if ( book == "HW3") { req_hw3_page = cur_hw3_page = parseInt(page); }
					if ( book == "HW4") { req_hw4_page = cur_hw4_page = parseInt(page); }
					if ( book == "HA") { req_ha_page = cur_ha_page = parseInt(page); }
					if ( book == "SG") { req_sg_page = cur_sg_page = parseInt(page); }
					if ( book == "BR") { req_br_page = cur_br_page = parseInt(page); }
					if ( book == "PR") { req_pr_page = cur_pr_page = parseInt(page); }
					if ( book == "LL") {
		  			var cgi_vol_page = keyValuePair[1].split('_');
			  		//debug( cgi_vol_page);
						req_ll_vol = cur_ll_vol = parseInt(cgi_vol_page[0]);
						req_ll_page = cur_ll_page = parseInt(cgi_vol_page[1]);
					}
					if ( book == "LS") { req_ls_page = cur_ls_page = parseInt(page); }
					if ( book == "HW4_HIDE" && ! hw4_hide ) { hw4_hide = true; hide_show( 'hanswehr4', 'hw4_toggle'); }
					if ( book == "HW3_HIDE" && ! hw3_hide ) { hw3_hide = true; hide_show( 'hanswehr3', 'hw3_toggle'); }
					if ( book == "HA_HIDE" && ! ha_hide ) { ha_hide = true; hide_show( 'hava', 'ha_toggle'); }
					if ( book == "SG_HIDE" && ! sg_hide ) { sg_hide = true; hide_show( 'steingass', 'sg_toggle'); }
					if ( book == "LL_HIDE" && ! ll_hide ) { ll_hide = true; hide_show( 'laneslexicon', 'll_toggle'); }
					if ( book == "LS_HIDE" && ! ls_hide ) { ls_hide = true; hide_show( 'laneslexiconsup', 'ls_toggle'); }
					if ( book == "BR_HIDE" && ! br_hide ) { br_hide = true; hide_show( 'brill', 'br_toggle'); }
					if ( book == "PR_HIDE" && ! pr_hide ) { pr_hide = true; hide_show( 'penrice', 'pr_toggle'); }
	    } 
	} 
	else { 
		alert ('Nothing found');
	    // No variables in the hash 
	} 
					//debug( "cur_ll_vol, cur_ll_page: " + cur_ll_vol +", "+ cur_ll_page);
					//debug( "cur_hw3_page: " + cur_hw3_page);
	display_images();
	set_title();
}

function shift_page( book, offset) {
	hide_id('about');
	if ( book == "HW4") { 
		req_hw4_page = cur_hw4_page + offset;
		$(window).scrollTop( $("#hanswehr4").offset().top);
	}
	if ( book == "HW3") { 
		req_hw3_page = cur_hw3_page + offset;
		$(window).scrollTop( $("#hanswehr3").offset().top);
	}
	if ( book == "HA") { 
		req_ha_page = cur_ha_page + offset;
		$(window).scrollTop( $("#hava").offset().top);
	}
	if ( book == "SG") { 
		req_sg_page = cur_sg_page + offset;
		$(window).scrollTop( $("#steingass").offset().top);
	}
	if ( book == "BR") { 
		req_br_page = cur_br_page + offset;
		$(window).scrollTop( $("#brill").offset().top);
	}
	if ( book == "PR") { 
		req_pr_page = cur_pr_page + offset;
		$(window).scrollTop( $("#penrice").offset().top);
	}
	if ( book == "LL") {
		var req_ll = ll_validate_vol_page( cur_ll_vol, cur_ll_page + offset);
		req_ll_vol = req_ll[0];
		req_ll_page = req_ll[1];
		$(window).scrollTop( $("#laneslexicon").offset().top);
	}
	if ( book == "LS") { 
		req_ls_page = cur_ls_page + offset;
		$(window).scrollTop( $("#laneslexiconsup").offset().top);
	}
	//debug( book + cur_ll_vol + "_" + req_ll_page);
	searched_word = "";
	build_hash();
	//parse_hash();
}

function percentVisible( elem)
{
	// This returns how many % of the screen contains element 'elem'
	if ( $(elem).css('display') == "none" ) return 0;
  var docViewTop = $(window).scrollTop();
  var docViewBottom = docViewTop + $(window).height();

  var elemTop = $(elem).offset().top;
  var elemBottom = elemTop + $(elem).height();
	//debug( $(elem).height());
	var perc_vis = 0;

	// The only assumption here is that the element spans more than 1 screen height
	if ( elemTop <= docViewTop && elemBottom >= docViewBottom) perc_vis = 100;
	else if ( elemBottom < docViewTop || elemTop > docViewBottom) perc_vis = 0;
	else if ( elemTop >= docViewTop ) perc_vis = (docViewBottom-elemTop) * 100  / $(window).height();
	else if ( elemBottom <= docViewBottom ) perc_vis = ( elemBottom-docViewTop) * 100 / $(window).height();
	
	//debug( perc_vis);
  
	return perc_vis;
}

function visible_book_shift( offset) {
	if ( percentVisible("#hanswehr3") > 50) shift_page( 'HW3', offset);
	else if ( percentVisible("#hanswehr4") > 50) shift_page( 'HW4', offset);
	else if ( percentVisible("#laneslexicon") > 50) shift_page( 'LL', offset);
	else if ( percentVisible("#laneslexiconsup") > 50) shift_page( 'LS', offset);
	else if ( percentVisible("#hava") > 50) shift_page( 'HA', offset);
	else if ( percentVisible("#steingass") > 50) shift_page( 'SG', offset);
	else if ( percentVisible("#brill") > 50) shift_page( 'BR', offset);
	else if ( percentVisible("#penrice") > 50) shift_page( 'PR', offset);
}


function display_images() {
	//ll_display_page( page);
	//debug ( ll_get_img_url( page));
	//document.getElementById("ll-narrow").src = ll_get_img_url( cur_ll_vol, cur_ll_page);

	if ( ! hw4_hide) {	
		//document.getElementById("hw4_load_status_line").innerHTML = "<br>Loading . . .";
		var hw4_img_url = hw4_get_img_url( cur_hw4_page);
		document.getElementById("hw4_col1").src = 
			document.getElementById("hw4_col2").src = 
			document.getElementById("hw4_wideviewimg").src = hw4_img_url;
		document.getElementById("hw4_status_line").innerHTML = 
			" <b>" + hw4[cur_hw4_page] + "</b> | " +
			"Hans Wehr (4), page " + (cur_hw4_page-hw4_offset+1) + 
			" <small>(of " + (hw4.length-1-hw4_offset) + ") " +
			"</small>"
			;
	}

	if ( ! hw3_hide) {	
		//document.getElementById("hw3_load_status_line").innerHTML = "<br>Loading . . .";
		var hw3_img_url = hw3_get_img_url( cur_hw3_page);
		document.getElementById("hw3_col1").src = 
			document.getElementById("hw3_col2").src = 
			document.getElementById("hw3_wideviewimg").src = hw3_img_url;
		document.getElementById("hw3_status_line").innerHTML = 
			" <b>" + hw3[cur_hw3_page] + "</b> | " +
			"Hans Wehr (3), page " + (cur_hw3_page-hw3_offset+1) + 
			" <small>(of " + (hw3.length-1-hw3_offset) + ") " +
			"</small>"
			;
	}

	if ( ! ha_hide) {	
		//document.getElementById("ha_load_status_line").innerHTML = "<br>Loading . . .";
		var ha_img_url = ha_get_img_url( cur_ha_page);
		document.getElementById("ha_col1").src = 
			document.getElementById("ha_col2").src = 
			document.getElementById("ha_wideviewimg").src = ha_img_url;
		document.getElementById("ha_status_line").innerHTML = 
			" <b>" + ha_p[cur_ha_page] + "</b> | " +
			"Hava, page " + (cur_ha_page-ha_offset+1) + 
			" <small>(of " + (ha_p.length-1-ha_offset) + ") " +
			"</small>"
			;
	}

	if ( ! sg_hide) {	
		//document.getElementById("sg_load_status_line").innerHTML = "<br>Loading . . .";
		var sg_img_url = sg_get_img_url( cur_sg_page);
		document.getElementById("sg_col1").src = 
			document.getElementById("sg_col2").src = 
			document.getElementById("sg_wideviewimg").src = sg_img_url;
		document.getElementById("sg_status_line").innerHTML = 
			" <b>" + sg[cur_sg_page] + "</b> | " +
			"Steingass, page " + (cur_sg_page-sg_offset+1) + 
			" <small>(of " + (sg.length-1-sg_offset) + ") " +
			"</small>"
			;
	}

	if ( ! br_hide) {	
		//document.getElementById("br_load_status_line").innerHTML = "<br>Loading . . .";
		var br_img_url = br_get_img_url( cur_br_page);
		// Brill doesn't have columns
		/*
		document.getElementById("br_col1").src = 
			document.getElementById("br_col2").src = 
		*/
			document.getElementById("br_wideviewimg").src = br_img_url;
		document.getElementById("br_status_line").innerHTML = 
			" <b>" + br[cur_br_page] + "</b> | " +
			"Brill, page " + (cur_br_page-br_offset+1) + 
			" <small>(of " + (br.length-1-br_offset) + ") " +
			"</small>"
			;
	}

	if ( ! pr_hide) {	
		//document.getElementById("pr_load_status_line").innerHTML = "<br>Loading . . .";
		var pr_img_url = pr_get_img_url( cur_pr_page);
		document.getElementById("pr_col1").src = 
			document.getElementById("pr_col2").src = 
			document.getElementById("pr_wideviewimg").src = pr_img_url;
		document.getElementById("pr_status_line").innerHTML = 
			" <b>" + pr[cur_pr_page] + "</b> | " +
			"Penrice, page " + (cur_pr_page-pr_offset+1) + 
			" <small>(of " + (pr.length-1-pr_offset) + ") " +
			"</small>"
			;
	}

	if ( ! ll_hide) {	
		//document.getElementById("ll_load_status_line").innerHTML = "<br>Loading . . .";
		var ll_img_url = ll_get_img_url( cur_ll_vol, cur_ll_page);
		document.getElementById("ll_col1").src = 
			document.getElementById("ll_col2").src = 
			document.getElementById("ll_col3").src = 
			document.getElementById("ll_wideviewimg").src = ll_img_url;
		document.getElementById("ll_status_line").innerHTML = 
			" <b>" + ll_p[get_ll_page( cur_ll_vol, cur_ll_page)] + "</b> | " +
			"Lane's Lexicon: Vol. " + cur_ll_vol + ", page " + cur_ll_page + 
			" <small>(of " + ll_volumes[cur_ll_vol-1] + ") = page " + get_ll_page( cur_ll_vol, cur_ll_page)  +
			" of " + (ll_p.length-1) + ".</small>"
			;
		//debug ( document.getElementById("ll_col1").src );
	}

	if ( ! ls_hide) {	
		//document.getElementById("ls_load_status_line").innerHTML = "<br>Loading . . .";
		var ls_img_url = ls_get_img_url( cur_ls_page);
		document.getElementById("ls_col1").src = 
			document.getElementById("ls_col2").src = 
			document.getElementById("ls_col3").src = 
			document.getElementById("ls_wideviewimg").src = ls_img_url;
		document.getElementById("ls_status_line").innerHTML = 
			" <b>" + ls_p[cur_ls_page] + "</b> | " +
			"LL supplement, page " + cur_ls_page + 
			" <small>(of " + ls_p.length + ") " +
			"</small>"
			;
		//debug( hw3_img_url);
	}
}

function debug( text) {
	document.getElementById("debug").innerHTML += "<br> [" + text + "] ";
}

// http://constc.blogspot.com/2008/07/undeclared-undefined-null-in-javascript.html
function isUndefined(x) { return x == null && x !== null; }

function first_page_load() {

	if ( $(document.body).width() < 750){ toggle = 2; } 
	else { toggle = 1; }
	toggle_view();
	
	// first sort out the book order
	var saved_book_order = getCookie('aa_book_order');
	//alert('test');
	//debug('aa_book_order in cookie = ' + saved_book_order);
	if ( isUndefined(saved_book_order) || saved_book_order == "" || saved_book_order === null )
		aa_book_order = initial_book_order;
	else
		aa_book_order = saved_book_order;
	//debug('using aa_book_order: ' + aa_book_order);
	set_book_order();

	
	// Set default hash value, and show About if this appears to be the first visit
	if ( window.location.hash.replace(/^#/,'') == "") { 
		var aa_last_hash = getCookie("aa_last_hash");
		//debug( aa_last_hash);
		if ( isUndefined(aa_last_hash) || aa_last_hash == "") {
			window.location.hash = starting_hash;
			//toggle_about();
			//parse_hash();
		} else {
			window.location.hash = aa_last_hash;
		}
	} else parse_hash();
		
	var aa_fitwidth = getCookie("aa_fitwidth");
	if ( ! isUndefined(aa_fitwidth)) {
		fitwidth = aa_fitwidth;
	}

	set_fitwidth();
	init_settings();
}

function set_book_order() {
	var book_array = aa_book_order.split(',');
	for ( i = book_array.length - 1; i >= 0; i--) {
		//debug( book_array[i]);
		if ( book_array[i] != "" ) {
			//debug( book_array[i]);
			// Check if it exists (using .length seems the way to do this), 
			// as user may have data from the previous version in their cookie
			if ( $('#'+book_array[i]).length > 0 ) {
				var content = document.getElementById(book_array[i]);
				var parent = content.parentNode;
				parent.insertBefore(content, parent.firstChild);
			}
			//debug( book_array[i]);
		}
	}
	setCookie('aa_book_order', aa_book_order, 365);
}

function init_settings() {
	var available_books = ["HW4","LL","LS","BR","PR","SG","HA","HW3"];
	var table_html = "<table><tr>\n";
	for (var row = 0; row <= available_books.length; row++) {
		//var rowpp = row + 1;
		for (var book = 0 ; book < available_books.length; book++) {
			//var bookpp = book + 1;
			if (book == 0) {
				table_html += "<tr>";
				if (row == 0) table_html += "<td>";
				else  table_html += "<td>" + row;
			}

			if (row == 0) {
				table_html += "<th class='" + available_books[book] + "_color'><b>" + available_books[book] + "</b>";
			} else {
				table_html += "<td class='" + available_books[book] + "_color'><input type='radio' name='setbook" + row + "' value='" + available_books[book] + "'>";
			}
		}
	}
	table_html += "</table>";
	//console.debug(table_html);
	$("#settings_2").html(table_html);

	update_settings_order( aa_book_order);

	$("#version").append(title_text);
}

function update_settings_order( order_toset) {
	var book_array = order_toset.split(',');
	for ( i = book_array.length - 1; i >= 0; i--) {
		var j = i + 1;
		$("input[name=setbook"+j+"][value=" + book_array[i] + "]").prop('checked', true);
	}
}

function set_order_preset( preset_requested) {
	var new_book_order = initial_book_order;
	if ( preset_requested == "quran")  new_book_order = "BR,PR,LL,LS,SG,HW4,HA,HW3";
	if ( preset_requested == "modern") new_book_order = "HW4,SG,LL,LS,HA,BR,PR,HW3";
	// Default is above already
	// if ( preset_requested == "default")
	update_settings_order( new_book_order);
}

function save_settings() {
	var new_book_order = "";
	for ( i = 1; i <= 7; i++ ) new_book_order += $('input[name = "setbook' + i + '"]:checked').val() + ',';
	new_book_order += $('input[name = "setbook8"]:checked').val();
	//new_book_order += $("#setbook8").val();
	//debug(new_book_order);
	aa_book_order = new_book_order;
	set_book_order();
	toggle_settings();
}

function testing123() {
	var i = 1;
	$('#all_books').children().each(function(){
	 var kid = $(this);
	 debug( kid.attr('id'));
	 i++;
	});

	/*
	for (i=0; i< $('#all_books').children().size(); i++) {
		debug( i);
		debug( $('#all_books').children()[i].attr('id'));
	}
	$(e.target).children().each(function(){
	 var kid = $(this);
	  console.log(kid, kid.attr('id'), kid.attr('class'));
		});
		*/
	//debug( $('#all_books').children().attr('id').each() );
	
	//debug( isScrolledIntoView("#hanswehr"));
//scroll_to_id( 'll_status_line');
//parse_hash();
//document.getElementById("renderedsite").innerHTML = "";
// document.getElementById("renderedsite").innerHTML = document.getElementById("testinput").innerHTML;
	
}


function showindex() {
	document.getElementById("chapters_index").innerHTML = '<hr>';
	for (var i = 0; i < chapters.length; i++) {
		document.getElementById("chapters_index").innerHTML += 
			"<a href='javascript:showchap(" + i + ")'><span class='indexbutton'> " +
			chapters[i][0] + " </span></a>\n";
	}
	document.getElementById("about").style['display'] = 'none';
	scroll( 0, 0);
}

function showcurchap() { showchap( getchap(cur_page)) };
function showchap( chap) {
	var end;
	document.getElementById("chapters_index").innerHTML = '';
	document.getElementById("chapter_contents").innerHTML = '<hr>';
	if ( chap == chapters.length - 1 ) { end = items.length + offset; }
	else { end = chapters[chap+1][1]; }
	//alert( 'end = ' + end );
	for (var i = chapters[chap][1]; i < end; i++) {
		var header_index = i - offset;
		var append = '';
		if ( header_index < 0) { append = 'page ' + i; }
		else { append = items[header_index]; } 
		document.getElementById("chapter_contents").innerHTML += 
			"<a href='#" + i + "'><span class='indexbutton'> " +
			append + " </span></a>\n";
	}
	document.getElementById("about").style['display'] = 'none';
	scroll( 0, 0);
}


function toggle_fitwidth() {

	if ( toggle_view_mode == 1) {
	  if ( fitwidth == false) {
			fitwidth = true;
		} else { 
			fitwidth = false;
		}
	}
	setCookie('aa_fitwidth', fitwidth, 365);
	set_fitwidth();
}

function set_fitwidth() {
	if ( toggle_view_mode == 1) {
		var mw = '';
	  if ( fitwidth == false) {
			$("#currentmode").html('full width');
		} else { 
			mw = '99%';
			$("#currentmode").html('fit width');
		}
 		$('.wideview').each(function(index) {
				$(this).css('max-width', mw);
    });
		$("#br_wideviewimg").css('max-width', mw);
		//debug("br_wideview: " + $("#br_wideview").css('max-width'));
	}
}

function toggle_view() {
	// TODO: JQuery-fy this silliness:
	toggle_view_auto = 0;
	if (toggle == 1) {
		$(".narrowview").hide();
		$(".wideview").show();
		$("#br_wideviewimg").css('max-width', '');
		$("#currentmode").html("Desktop (full page)");
		toggle_view_mode = 1;
		toggle = 2;
	} else {
		$(".narrowview").show();
		$(".wideview").hide();
		$("#br_wideviewimg").css('max-width', '99%');
		$("#currentmode").html("Mobile (column)");
		toggle = 1;
		toggle_view_mode = 2;
	}

	//setCookie( "toggle_view_auto", toggle_view_auto, 365);
	setCookie( "aa_last_view_mode", toggle_view_mode, 365);
	set_fitwidth();
}

// Bind the event.
$(window).hashchange( function(){
	// Alerts every time the hash changes!
	//alert( location.hash );
	parse_hash();
})

/*
*/

function toggle_settings() {
		$('#settings_container').toggle('fast');
}


function searchandgo() {
	//var search = document.getElementById('search').value;
	var input = prompt( "Enter root letters in english or arabic to search (see About section)", last_input);
	if ( ! isUndefined( input))
		do_search( input);
}

function do_search( input) {
	var search = input;
	last_input = input;
	// TODO: converting all forms of alif and hamza                                             
	// (ء, آ, أ, ؤ, إ, ئ, ا) to a single character ء
	// أكل
	// Here's a funny hamza, what is it?
	// ha_p[25]="ءدب";
	// The same should be done for both forms of yaa (ي, ى)
	/*
		Perform search and replace mostly according to the Arabic Chat Alphabet:
		http://en.wikipedia.org/wiki/Arabic_chat_alphabet
	search = search.replace(//gi,"");
	*/
	// Normalize alifs and yas, not sure if this is right yet?
	// The first character (hamza above alif) is different from the second one, different code page?
	// From android: ء ٱ آ إ
	search = search.replace(/[إآٱأءﺀﺀﺁﺃﺅﺇﺉ]/g,"ا");
	search = search.replace(/[ﻯ]/g,"ي");
	// Firstly the letters that take IMHO 2 letters to transliterate
	search = search.replace(/th/g,"ث");
	search = search.replace(/gh/g,"غ");
	search = search.replace(/kh/g,"خ");
	search = search.replace(/sh/g,"ش");
	search = search.replace(/dh/g,"ذ");
	// Hmm, make the following case insensitive and assign different letters to different cases:
	search = search.replace(/d/g,"د");
	search = search.replace(/D/g,"ض");
	search = search.replace(/z/g,"ز");
	search = search.replace(/Z/g,"ظ");
	search = search.replace(/s/g,"س");
	search = search.replace(/S/g,"ص");
	search = search.replace(/t/g,"ت");
	search = search.replace(/T/g,"ط");
	search = search.replace(/h/g,"ه");
	search = search.replace(/H/g,"ح");
	// Not much iktilaaf over these I guess:
	search = search.replace(/x/g,"خ");
	search = search.replace(/v/g,"ث");
	search = search.replace(/a/g,"ا");
	search = search.replace(/b/g,"ب");
	search = search.replace(/j/g,"ج");
	search = search.replace(/7/g,"ح");
	search = search.replace(/r/g,"ر");
	search = search.replace(/3/g,"ع");
	search = search.replace(/E/g,"ع");
	search = search.replace(/e/g,"ع");
	search = search.replace(/f/g,"ف");
	search = search.replace(/q/g,"ق");
	search = search.replace(/k/g,"ك");
	search = search.replace(/l/g,"ل");
	search = search.replace(/m/g,"م");
	search = search.replace(/n/g,"ن");
	search = search.replace(/w/g,"و");
	search = search.replace(/y/g,"ي");
	//alert( "Searching for: " + search);
	// Headers 
	req_sg_page = binarySearch( sg, search, 0);
	req_br_page = binarySearch( br, search, 0);
	req_pr_page = binarySearch( pr, search, 0);
	req_ha_page = binarySearch( ha_p, search, 0);
	// Fudge was set to -1, but this often leads to the wrong page
	req_hw3_page = binarySearch( hw3, search, 0);
	req_hw4_page = binarySearch( hw4, search, 0);
	req_ll = get_ll_volume_page( binarySearch( ll_p, search, -1));
	req_ll_vol = req_ll[0];
	req_ll_page = req_ll[1];
	req_ls_page = binarySearch( ls_p, search, -1);	
	if ( req_ls_page < 3) {
		// Nothing useful found, hide it:
		document.getElementById("ls_search_status").innerHTML =
			"Not found in supplement | ";
		hide_show( 'laneslexiconsup', 'ls_toggle');
		
	} else document.getElementById("ls_search_status").innerHTML = "";

	document.getElementById("searchbar").innerHTML = 
		"Searched for: <strong>" + input + "</strong> (" + search + ") |";
	
	// set searched_word first because build_hash() will lead to set_title() where it is used
	searched_word = search;

	build_hash();
	//parse_hash();
	
}

function load_imgs( page_num) {
	if ( page_num < 0 ) { page_num = 0; }
	if ( page_num > total_pages ) { page_num = total_pages - 1; }
	//alert( page_num);
	setCookie( "last_page", page_num, 31);
	document.getElementById("chapters_index").innerHTML = '';
	document.getElementById("chapter_contents").innerHTML = '';
	document.getElementById("a_prev").href = '#' + (page_num-1);
	document.getElementById("a_next").href = '#' + parseInt(parseInt(page_num)+1);
	document.getElementById("a_prev2").href = '#' + (page_num-1);
	document.getElementById("a_next2").href = '#' + parseInt(parseInt(page_num)+1);
	//document.getElementById("a_prev").href = '?page=' + (page_num-1);
	//document.getElementById("a_next").href = '?page=' + parseInt(parseInt(page_num)+1);
	document.getElementById("statusbar").innerHTML = 
		"Hans Wehr - chapter <em class='small_button'><a href='javascript:showcurchap()'>" +
		chapters[getchap(page_num)][0] +
		"</a></em> - page " 
		+ "<input type=text size=5 onkeypress=\"checkKey(event)\" id=input_no value='" + (page_num-offset+1) + "'>"
		+ " : " +
		"<strong>" + items[page_num-offset] + "</strong>"
		;

	//+ page_num 
	document.title = 'p. ' + page_num + ' (' + items[page_num-offset] + ') - Hans Wehr';
	var imgs = document.getElementsByTagName("img"); 
	var img_url = Math.floor(page_num/100) + "/hw-" + page_num + ".gif"; //img[i].src is the reference to the image. 
	for (var i = 0, l = imgs.length; i < l; i++) { 
		imgs[i].src = img_url;
		imgs[i].style['display'] = 'block';
	}
	scroll( 0, 0);
	cur_page = page_num;
	//alert( 'done loading');
}

function checkKey(e) {
    var charCode;
    
    if(e && e.which){
        charCode = e.which;
    }else if(window.event){
        e = window.event;
        charCode = e.keyCode;
    }

    if(charCode == 13) {
			self.document.location.hash = parseInt(document.getElementById("input_no").value) + offset - 1;
			//load_imgs( document.getElementById("input_no").value);
    }
}

function getCookie(c_name) {
	// Local Storage is the way of the future
	/*
	var i,x,y,ARRcookies=document.cookie.split(";");
	for (i=0;i<ARRcookies.length;i++) {
  	x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));
  	y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);
  	x=x.replace(/^\s+|\s+$/g,"");
  	if (x==c_name) { return unescape(y); }
  }
	*/
	return localStorage.getItem(c_name);
}

function setCookie(c_name,value,exdays)
{
	// Local Storage is the way of the future
	var exdate=new Date();
	exdate.setDate(exdate.getDate() + exdays);
	var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
	document.cookie=c_name + "=" + c_value;
	localStorage.setItem(c_name, value);
}

//Copyright 2009 Nicholas C. Zakas. All rights reserved.
//MIT-Licensed, see source file
function binarySearch(items, value, exact_match_fudge){
		/*
			exact_match_fudge is the offset to return when an exact
			match is found. By default we track back at least 20 places
			to find the first occurance, however do we then return
			the first occurance or the one before?
			exact_match_fudge = 0 means yes (the former)
			exact_match_fudge = -1 means the one before
		*/

		value = value.replace( /\s*/g, "");

    var startIndex  = 0,
        stopIndex   = items.length - 1,
        middle      = Math.floor((stopIndex + startIndex)/2),
				retval = 0;

    while(items[middle] != value && startIndex < stopIndex){

        //adjust search area
        if (value < items[middle]){
            stopIndex = middle - 1;
        } else if (value > items[middle]){
            startIndex = middle + 1;
        }

        //recalculate middle
        middle = Math.floor((stopIndex + startIndex)/2);
    }
		if ( middle == 0) retval = 0;
		if ( items[middle] == value) {
			// Trace back to a max of 20 items to get the first occurance of items[middle] == value
			for (i = 1; i < 20; i++) {
				if ( items[middle-i] != value) {
					// Give the first match if searching for the start of a chapter
					if ( value.length == 1 && exact_match_fudge == -1)
						retval = middle-i+2+exact_match_fudge;
					else 
						retval = middle-i+1+exact_match_fudge;
					break;
				}
				
			}
		} else {
    	//return (items[middle] != value) ? -1 : middle;
    	//return (items[middle] > value && middle > 0) ? middle-1 : middle;
    	//retval = (value > items[middle]) ? middle+1+exact_match_fudge : middle+exact_match_fudge;
    	if (value > items[middle]) retval = middle+1+exact_match_fudge;
			else retval = middle+exact_match_fudge;
		}
		//debug( 'search = ' + value + ' retval = ' + retval + ' which is: ' + items[retval]);
		return retval;
}

// Do page_load once
first_page_load();

//==========================================================
/* The javascript graveyard:
*/

</script>
<!-- awstats statistics collection script -->
<script language=javascript src="jslib/awstats_misc_tracker.js"></script>
<noscript><img src="jslib/awstats_misc_tracker.js?nojs=y" height=0 width=0 border=0 style="display: none"></noscript>
<!-- /awstats statistics collection script -->

</body>
</html>
